# JVM如何实现invokedynamic？（上）

在Java中，方法调用会被编译为invokestatic，invokespecial，invokevirtual以及invokeinterface四种指令。这些指令与包含目标方法类名、方法名以及方法描述符的符号引用捆绑。在实际运行之前，JVM将根据这个符号引用链接到具体的目标方法。

Java 7引入了一条新的指令invokedynamic。该指令的调用机制抽象出调用点这一个概念，并允许应用程序将调用点链接至任意符号条件的方法上。

作为invokedynamic的准备工作，Java 7引入了更加底层、更加灵活的方法抽象：方法句柄（MethodHandle）。

## 方法句柄的概念

方法句柄是一个强类型的，能够被直接执行的引用。该引用可以指向常规的静态方法或者实例方法，也可以指向构造器或者字段。当指向字段时，方法句柄实则指向包含字段访问字节码的虚构方法，语义上等价于目标字段的getter或者setter方法。

方法句柄的类型（MethodType）是由所指向方法的参数类型以及返回类型组成的。它是用来确认方法句柄是否适配的唯一关键。当使用方法句柄时，我们其实并不关心方法句柄所指向方法的类名或者方法名。

## 方法句柄的操作

方法句柄的调用可分为两种，一是需要严格匹配参数类型的invokeExact。第二种调用方式invoke是一个签名多态性的方法。

方法句柄的调用和反射调用一样，都是间接调用，同样会面临无法内联的问题。

