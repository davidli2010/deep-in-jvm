# Java代码是怎么运行的？

JRE(Java Runtime Environment): Java运行时环境。JRE仅包含运行Java程序的必需组件，包括Java虚拟机以及Java核心类库等。

JDK(Java Development Kit): Java开发套件。JDK包含JRE，并且附带了一系列开发诊断工具。

## 为什么Java要在虚拟机里运行？

- 跨平台：一次编写，随处运行；
- 托管环境：自动内存管理与垃圾回收，数组越界、动态类型、安全权限等的动态检测。

Java是高级语言，语法复杂，抽象程度高。通过设计一个面向Java语言特性的虚拟机，并通过编译器将Java程序转换成虚拟机所能识别的指令序列，也称Java字节码。

## Java虚拟机怎样运行Java字节码？

执行Java代码首先需要将它编译而成的class文件加载到Java虚拟机中。加载后的Java类会被存放于方法区（Method Area）中。实际运行时，虚拟机会执行方法区中的代码。

运行时内存：
- 方法区
- 堆
- PC寄存器
- Java方法栈
- 本地方法栈

从硬件看，Java字节码无法直接执行，JVM需要将字节码翻译成机器码。
- 解释执行：逐条将字节码翻译成机器码并执行；
- 即时编译（Just-In-Time， JIT）：将一个方法中包含的所有字节码编译成机器码后再执行。

Hotspot内置了多个即时编译器：C1、C2和Graal。
从Java 7开始，Hotspot默认采用分层编译的方式：热点方法首先会被C1编译，而后热点方法中的热点会进一步被C2编译。
